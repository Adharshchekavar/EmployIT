{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Complaints | EmployIT Admin</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --blue:      #3B4FD8;
      --blue-dark: #2a3ab5;
      --blue-light:#6B7FE8;
      --blue-pale: #EEF0FC;
      --accent:    #F5A623;
      --red:       #dc2626;
      --red-pale:  #fff0f0;
      --text:      #1a1d2e;
      --muted:     #6b7280;
      --bg:        #f7f8ff;
      --white:     #ffffff;
    }

    html { scroll-behavior: smooth; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); }
    h1,h2,h3,h4 { font-family: 'Playfair Display', serif; }
    em { color: var(--red); font-style: normal; }

    /* ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ */
    .navbar {
      backdrop-filter: blur(14px);
      background: rgba(247,248,255,0.92) !important;
      border-bottom: 1px solid rgba(59,79,216,0.08);
      box-shadow: 0 4px 30px rgba(59,79,216,0.08);
    }
    .navbar-brand img { height: 40px; }
    .btn { border-radius: 50px !important; font-weight: 600; font-family: 'DM Sans', sans-serif; transition: all .25s; }
    .btn-employit { background: var(--blue); color: #fff; border: 2px solid var(--blue); }
    .btn-employit:hover { background: var(--blue-dark); color: #fff; transform: translateY(-1px); }
    .btn-back { background: var(--blue-pale); color: var(--blue); border: 2px solid var(--blue-pale); }
    .btn-back:hover { background: var(--blue); color: #fff; border-color: var(--blue); }

    /* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
    .page-header {
      background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 50%, #b91c1c 100%);
      padding: 5rem 0 5rem;
      margin-top: 72px;
      position: relative; overflow: hidden;
    }
    .page-header::before {
      content: ''; position: absolute; top: -60px; right: -60px;
      width: 380px; height: 380px;
      background: rgba(255,255,255,0.05); border-radius: 50%;
    }
    .page-header::after {
      content: ''; position: absolute; bottom: -80px; left: 5%;
      width: 260px; height: 260px;
      background: rgba(245,166,35,0.1); border-radius: 50%;
    }
    .page-header h1 { color: #fff; font-size: clamp(1.8rem, 4vw, 2.6rem); }
    .page-header p  { color: rgba(255,255,255,.65); margin: 0; font-size: .95rem; }
    .header-pill {
      display: inline-flex; align-items: center; gap: .5rem;
      background: rgba(255,255,255,.12); color: rgba(255,255,255,.9);
      padding: .35rem 1rem; border-radius: 50px;
      font-size: .8rem; font-weight: 600;
      margin-bottom: 1rem; backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,.15);
    }

    /* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
    .messages-wrap { margin-top: -1.5rem; position: relative; z-index: 20; margin-bottom: 1rem; }
    .django-message {
      border-radius: 16px; padding: 1rem 1.4rem;
      display: flex; align-items: center; gap: .8rem;
      font-size: .9rem; font-weight: 500;
    }
    .django-message.success { background: #f0fdf4; border: 2px solid #86efac; color: #166534; }
    .django-message.error   { background: #fef2f2; border: 2px solid #fca5a5; color: #991b1b; }

    /* ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ */
    .filter-card {
      background: var(--white); border-radius: 24px;
      padding: 1.4rem 2rem;
      box-shadow: 0 8px 30px rgba(59,79,216,0.09);
      margin-top: -2rem; position: relative; z-index: 10;
      display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;
    }
    .filter-input {
      flex: 1; min-width: 200px;
      border: 2px solid var(--blue-pale); border-radius: 50px;
      padding: .6rem 1.2rem;
      font-family: 'DM Sans', sans-serif; font-size: .92rem;
      color: var(--text); background: var(--bg);
      transition: border-color .2s;
    }
    .filter-input:focus { border-color: var(--blue); outline: none; box-shadow: 0 0 0 3px rgba(59,79,216,.1); }

    /* ‚îÄ‚îÄ TABLE CARD ‚îÄ‚îÄ */
    .table-card {
      background: var(--white); border-radius: 24px;
      box-shadow: 0 8px 30px rgba(59,79,216,0.09);
      overflow: hidden;
    }
    .table-card-header {
      padding: 1.4rem 2rem;
      border-bottom: 1px solid var(--blue-pale);
      display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: .8rem;
    }
    .table-card-header h4 { font-size: 1.15rem; margin: 0; }
    .count-badge {
      background: #fee2e2; color: #dc2626;
      font-size: .8rem; font-weight: 700; border-radius: 50px; padding: .35rem 1rem;
    }

    /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
    .admin-table { width: 100%; border-collapse: collapse; }
    .admin-table thead tr {
      background: var(--bg); border-bottom: 2px solid var(--blue-pale);
    }
    .admin-table thead th {
      padding: 1rem 1.5rem;
      font-size: .75rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .8px;
      color: var(--muted); white-space: nowrap;
    }
    .admin-table tbody tr {
      border-bottom: 1px solid var(--blue-pale);
      transition: background .2s;
    }
    .admin-table tbody tr:hover { background: #fff5f5; }
    .admin-table tbody tr:last-child { border-bottom: none; }
    .admin-table td { padding: 1.1rem 1.5rem; vertical-align: middle; }

    /* User / Worker cells */
    .user-cell { display: flex; align-items: center; gap: .75rem; }
    .mini-avatar {
      width: 38px; height: 38px; border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: .82rem; color: #fff; flex-shrink: 0;
    }
    .av-user   { background: linear-gradient(135deg,#3B4FD8,#6B7FE8); }
    .av-worker { background: linear-gradient(135deg,#dc2626,#ef4444); }
    .cell-name { font-weight: 600; font-size: .9rem; margin: 0; }
    .cell-sub  { font-size: .73rem; color: var(--muted); margin: 0; }

    /* Complaint count badge */
    .complaint-count {
      background: #fee2e2; color: #dc2626;
      font-size: .78rem; font-weight: 700;
      border-radius: 50px; padding: 4px 14px;
      display: inline-flex; align-items: center; gap: .35rem;
      border: 1.5px solid #fca5a5;
    }

    /* Action buttons */
    .btn-view-sm {
      background: var(--blue-pale); color: var(--blue);
      border: 1.5px solid rgba(59,79,216,0.2);
      padding: .35rem .9rem; font-size: .8rem;
    }
    .btn-view-sm:hover { background: var(--blue); color: #fff; border-color: var(--blue); }
    .btn-terminate {
      background: #fee2e2; color: #dc2626;
      border: 1.5px solid #fca5a5;
      padding: .35rem .9rem; font-size: .8rem;
    }
    .btn-terminate:hover { background: #dc2626; color: #fff; border-color: #dc2626; }

    /* Empty state */
    .empty-cell { text-align: center; padding: 4rem 2rem; }
    .empty-icon { font-size: 3rem; opacity: .2; margin-bottom: .8rem; }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer { background: var(--white); border-top: 1px solid rgba(59,79,216,.08); margin-top: 4rem; }
    .footer-bottom { font-size: .8rem; color: var(--muted); padding: 1.2rem 0; }

    /* ‚îÄ‚îÄ REVEAL ‚îÄ‚îÄ */
    .reveal { opacity: 0; transform: translateY(20px); transition: opacity .6s ease, transform .6s ease; }
    .reveal.visible { opacity: 1; transform: none; }
    .rv1 { transition-delay: .1s; } .rv2 { transition-delay: .2s; }

    .table-scroll { overflow-x: auto; }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav class="navbar fixed-top py-3">
  <div class="container-xl d-flex justify-content-between align-items-center">
    <a href="/" class="navbar-brand">
      <img src="{% static 'img/logo1.png' %}" alt="EmployIT">
    </a>
    <div class="d-flex gap-2">
      <a href="/admin_workers/" class="btn btn-back px-4">
        <i class="bi bi-shield-check me-1"></i>Verification
      </a>
      <a href="/admin_home/" class="btn btn-employit px-4">
        <i class="bi bi-grid me-1"></i>Dashboard
      </a>
    </div>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page-header">
  <div class="container-xl">
    <div class="header-pill"><i class="bi bi-flag-fill me-1"></i> Admin Panel</div>
    <h1 class="fw-bold mb-2">Worker <em>Complaints</em></h1>
    <p>Review flagged workers and take action ‚Äî warn or terminate.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="container-xl pb-5">

  <!-- Django messages -->
  {% if messages %}
  <div class="messages-wrap">
    {% for message in messages %}
    <div class="django-message {{ message.tags }} mb-2">
      {% if message.tags == 'success' %}
        <i class="bi bi-check-circle-fill" style="font-size:1.2rem; color:#16a34a"></i>
      {% else %}
        <i class="bi bi-exclamation-circle-fill" style="font-size:1.2rem; color:#dc2626"></i>
      {% endif %}
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}


  <!-- Table Card -->
  <div class="table-card mt-4 reveal rv1">
    <div class="table-card-header">
      <h4>Complaint <em>Log</em></h4>
      <span class="count-badge">
        <i class="bi bi-flag me-1"></i>{{ complaints|length }} Report{{ complaints|length|pluralize }}
      </span>
    </div>

    <div class="table-scroll">
      <table class="admin-table" id="complaintsTable">
        <thead>
          <tr>
            <th><i class="bi bi-person me-1"></i>Filed By</th>
            <th><i class="bi bi-person-badge me-1"></i>Against Worker</th>
            <th><i class="bi bi-flag me-1"></i>Complaints</th>
            <th style="text-align:center"><i class="bi bi-gear me-1"></i>Actions</th>
          </tr>
        </thead>
        <tbody>

          {% for c in complaints %}
          <tr class="complaint-row"
              data-user="{{ c.user__username|lower }}"
              data-worker="{{ c.worker__user__username|lower }}">

            <!-- User -->
            <td>
              <div class="user-cell">
                <div class="mini-avatar av-user">
                  {{ c.user__username|slice:":2"|upper }}
                </div>
                <div>
                  <p class="cell-name">{{ c.user__username|title }}</p>
                  <p class="cell-sub">user</p>
                </div>
              </div>
            </td>

            <!-- Worker -->
            <td>
              <div class="user-cell">
                <div class="mini-avatar av-worker">
                  {{ c.worker__user__username|slice:":2"|upper }}
                </div>
                <div>
                  <p class="cell-name">{{ c.worker__user__username|title }}</p>
                  <p class="cell-sub">Worker ID #{{ c.worker__id }}</p>
                </div>
              </div>
            </td>

            <!-- Count -->
            <td>
              <span class="complaint-count">
                <i class="bi bi-exclamation-triangle-fill"></i>
                {{ c.total }} complaint{{ c.total|pluralize }}
              </span>
            </td>

            <!-- Actions -->
            <td>
              <div class="d-flex gap-2 justify-content-center flex-wrap">
                <a href="/view_complaints/{{ c.worker__id }}/{{ c.user__username }}/"
                   class="btn btn-view-sm">
                  <i class="bi bi-eye me-1"></i>View
                </a>
                <a href="/terminate_worker/{{ c.worker__id }}/"
                   class="btn btn-terminate"
                   onclick="return confirm('Terminate {{ c.worker__user__username }}? This cannot be undone.')">
                  <i class="bi bi-slash-circle me-1"></i>Terminate
                </a>
              </div>
            </td>

          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="empty-cell">
              <div class="empty-icon">üè≥Ô∏è</div>
              <h5 style="font-family:'Playfair Display',serif">No Complaints Yet</h5>
              <p style="color:var(--muted); font-size:.88rem; margin:0">All clear ‚Äî no complaints have been filed.</p>
            </td>
          </tr>
          {% endfor %}

        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<footer>
  <div class="container-xl">
    <div class="footer-bottom d-flex justify-content-between flex-wrap gap-2">
      <span>¬© 2026 EmployIT ¬∑ Admin Panel</span>
      <span>Made with ‚ù§Ô∏è for daily workers</span>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const observer = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
  }, { threshold: 0.08 });
  document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

  // Live search
  document.getElementById('searchInput').addEventListener('input', function () {
    const q = this.value.toLowerCase().trim();
    document.querySelectorAll('.complaint-row').forEach(row => {
      const match = row.dataset.user.includes(q) || row.dataset.worker.includes(q);
      row.style.display = match ? '' : 'none';
    });
  });
</script>
</body>
</html>