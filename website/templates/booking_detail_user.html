{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Booking History | EmployIT</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --blue:      #3B4FD8;
      --blue-dark: #2a3ab5;
      --blue-light:#6B7FE8;
      --blue-pale: #EEF0FC;
      --accent:    #F5A623;
      --text:      #1a1d2e;
      --muted:     #6b7280;
      --bg:        #f7f8ff;
      --white:     #ffffff;
    }

    html { scroll-behavior: smooth; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); }
    h1,h2,h3,h4 { font-family: 'Playfair Display', serif; }
    em { color: var(--blue); font-style: normal; }

    /* ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ */
    .navbar {
      backdrop-filter: blur(14px);
      background: rgba(247,248,255,0.92) !important;
      border-bottom: 1px solid rgba(59,79,216,0.08);
      box-shadow: 0 4px 30px rgba(59,79,216,0.08);
    }
    .navbar-brand img { height: 40px; }
    .btn { border-radius: 50px !important; font-weight: 600; font-family: 'DM Sans', sans-serif; transition: all .25s; }
    .btn-back { background: var(--blue-pale); color: var(--blue); border: 2px solid var(--blue-pale); }
    .btn-back:hover { background: var(--blue); color: #fff; border-color: var(--blue); }
    .btn-danger-soft { background: #fff0f0; color: #dc3545; border: 2px solid #ffd0d0; }
    .btn-danger-soft:hover { background: #dc3545; color: #fff; border-color: #dc3545; }

    /* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
    .page-header {
      background: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
      padding: 5rem 0 5rem;
      margin-top: 72px;
      position: relative; overflow: hidden;
    }
    .page-header::before {
      content: ''; position: absolute; top: -60px; right: -60px;
      width: 380px; height: 380px;
      background: rgba(255,255,255,0.06); border-radius: 50%;
    }
    .page-header::after {
      content: ''; position: absolute; bottom: -80px; left: 5%;
      width: 260px; height: 260px;
      background: rgba(245,166,35,0.12); border-radius: 50%;
    }
    .page-header h1 { color: #fff; font-size: clamp(2rem, 4vw, 2.8rem); }
    .page-header p  { color: rgba(255,255,255,.72); font-size: .95rem; margin: 0; }

    .welcome-pill {
      display: inline-flex; align-items: center; gap: .5rem;
      background: rgba(255,255,255,.15); color: #fff;
      padding: .35rem 1rem; border-radius: 50px;
      font-size: .8rem; font-weight: 600;
      margin-bottom: 1rem; backdrop-filter: blur(6px);
    }

    /* ‚îÄ‚îÄ STATS ROW ‚îÄ‚îÄ */
    .stats-row {
      display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem;
    }
    .stat-chip {
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 14px; padding: .55rem 1.2rem;
      color: #fff; display: flex; align-items: center; gap: .6rem;
      backdrop-filter: blur(6px);
    }
    .stat-chip .sc-num { font-family: 'Playfair Display', serif; font-size: 1.3rem; font-weight: 700; }
    .stat-chip .sc-lbl { font-size: .72rem; color: rgba(255,255,255,.65); font-weight: 500; }

    /* ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ */
    .filter-card {
      background: var(--white); border-radius: 24px;
      padding: 1.2rem 2rem;
      box-shadow: 0 8px 30px rgba(59,79,216,0.09);
      margin-top: -2rem; position: relative; z-index: 10;
      display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;
    }
    .filter-select {
      border: 2px solid var(--blue-pale); border-radius: 50px;
      padding: .55rem 1.4rem; font-family: 'DM Sans', sans-serif;
      font-size: .88rem; color: var(--text); background: var(--bg);
      cursor: pointer; transition: border-color .2s;
      appearance: none; -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' fill='%233B4FD8' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 1rem center; padding-right: 2.5rem;
    }
    .filter-select:focus { border-color: var(--blue); outline: none; }
    .filter-label { font-size: .82rem; font-weight: 600; color: var(--muted); white-space: nowrap; }

    /* ‚îÄ‚îÄ BOOKING CARDS ‚îÄ‚îÄ */
    .booking-card {
      background: var(--white);
      border-radius: 22px;
      padding: 1.6rem 2rem;
      box-shadow: 0 4px 20px rgba(59,79,216,0.07);
      border: 2px solid transparent;
      transition: transform .3s, box-shadow .3s, border-color .3s;
      position: relative; overflow: hidden;
    }
    .booking-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 45px rgba(59,79,216,0.13);
      border-color: var(--blue-pale);
    }

    /* Left accent bar */
    .booking-card::before {
      content: ''; position: absolute;
      top: 0; left: 0; width: 4px; height: 100%;
      border-radius: 4px 0 0 4px;
    }
    .bc-pending::before  { background: #f59e0b; }
    .bc-accepted::before { background: var(--blue); }
    .bc-rejected::before { background: #ef4444; }
    .bc-completed::before{ background: #16a34a; }

    /* Worker avatar */
    .worker-avatar {
      width: 50px; height: 50px; border-radius: 16px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 1rem; color: #fff; flex-shrink: 0;
    }
    .av-c0 { background: linear-gradient(135deg,#3B4FD8,#6B7FE8); }
    .av-c1 { background: linear-gradient(135deg,#10b981,#34d399); }
    .av-c2 { background: linear-gradient(135deg,#f59e0b,#fbbf24); }
    .av-c3 { background: linear-gradient(135deg,#ec4899,#f472b6); }
    .av-c4 { background: linear-gradient(135deg,#8b5cf6,#a78bfa); }
    .av-c5 { background: linear-gradient(135deg,#ef4444,#f87171); }

    .worker-name { font-family: 'Playfair Display', serif; font-size: 1.05rem; font-weight: 700; margin: 0; }
    .worker-skill { font-size: .82rem; color: var(--muted); margin: .1rem 0 0; }

    /* Meta items */
    .meta-row { display: flex; flex-wrap: wrap; gap: .6rem 1.4rem; margin-top: .9rem; }
    .meta-item {
      display: flex; align-items: center; gap: .35rem;
      font-size: .82rem; color: var(--muted);
    }
    .meta-item i { color: var(--blue); font-size: .9rem; }

    /* Status badges */
    .status-badge {
      display: inline-flex; align-items: center; gap: .35rem;
      font-size: .75rem; font-weight: 700; border-radius: 50px; padding: 4px 12px;
      white-space: nowrap;
    }
    .sb-pending   { background: #fffbeb; color: #92400e; border: 1.5px solid #fde68a; }
    .sb-accepted  { background: var(--blue-pale); color: var(--blue); border: 1.5px solid rgba(59,79,216,0.2); }
    .sb-rejected  { background: #fef2f2; color: #dc2626; border: 1.5px solid #fca5a5; }
    .sb-completed { background: #dcfce7; color: #16a34a; border: 1.5px solid #86efac; }

    /* Payment badge */
    .pay-badge {
      display: inline-flex; align-items: center; gap: .35rem;
      font-size: .75rem; font-weight: 700; border-radius: 50px; padding: 4px 12px;
    }
    .pay-unpaid { background: #fff7ed; color: #c2410c; border: 1.5px solid #fed7aa; }
    .pay-paid   { background: #dcfce7; color: #16a34a; border: 1.5px solid #86efac; }

    /* Fare display */
    .fare-tag {
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem; font-weight: 700; color: var(--text);
    }
    .fare-tag.paid { color: #16a34a; }

    /* View details button */
    .btn-view-detail {
      background: var(--blue-pale); color: var(--blue);
      border: 1.5px solid rgba(59,79,216,0.2);
      padding: .45rem 1.1rem; font-size: .82rem; text-decoration: none;
      display: inline-flex; align-items: center; gap: .4rem;
    }
    .btn-view-detail:hover { background: var(--blue); color: #fff; border-color: var(--blue); }

    /* Pay now button */
    .btn-pay-now {
      background: linear-gradient(135deg,#16a34a,#15803d);
      color: #fff; border: none;
      padding: .45rem 1.2rem; font-size: .82rem; text-decoration: none;
      display: inline-flex; align-items: center; gap: .4rem;
      box-shadow: 0 4px 14px rgba(22,163,74,.3);
    }
    .btn-pay-now:hover { transform: translateY(-1px); color: #fff; box-shadow: 0 8px 20px rgba(22,163,74,.4); }

    /* ‚îÄ‚îÄ RATING STARS ‚îÄ‚îÄ */
    .rating-display { display: flex; align-items: center; gap: .3rem; }
    .star-filled { color: var(--accent); font-size: .95rem; }
    .star-empty  { color: #d1d5db; font-size: .95rem; }

    /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
    .empty-state {
      text-align: center; padding: 5rem 2rem;
      background: var(--white); border-radius: 28px;
      box-shadow: 0 4px 20px rgba(59,79,216,0.06);
    }
    .empty-icon { font-size: 4rem; opacity: .2; margin-bottom: 1rem; }
    .empty-state h4 { font-family: 'Playfair Display', serif; margin-bottom: .5rem; }
    .empty-state p  { color: var(--muted); font-size: .92rem; }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer { background: var(--white); border-top: 1px solid rgba(59,79,216,.08); margin-top: 4rem; }
    .footer-bottom { font-size: .8rem; color: var(--muted); padding: 1.2rem 0; }

    /* ‚îÄ‚îÄ REVEAL ‚îÄ‚îÄ */
    .reveal { opacity: 0; transform: translateY(22px); transition: opacity .6s ease, transform .6s ease; }
    .reveal.visible { opacity: 1; transform: none; }
    .rv1 { transition-delay: .08s; } .rv2 { transition-delay: .16s; } .rv3 { transition-delay: .24s; }

    @media (max-width:576px) {
      .page-header { padding: 4rem 0 4.5rem; }
      .booking-card { padding: 1.2rem 1.4rem; }
      .filter-card  { padding: 1rem 1.2rem; }
    }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container-xl d-flex justify-content-between align-items-center">
    <a href="/" class="navbar-brand">
      <img src="{% static 'img/logo.png' %}" alt="EmployIT">
    </a>
    <div class="d-flex align-items-center gap-3">
      <a href="/user_home/" class="btn btn-back px-4">
        <i class="bi bi-arrow-left me-2"></i>Back
      </a>
      <a href="/logout/" class="btn btn-danger-soft px-4">
        <i class="bi bi-box-arrow-right me-1"></i>Logout
      </a>
    </div>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page-header">
  <div class="container-xl">
    <div class="welcome-pill"><i class="bi bi-clock-history me-1"></i> {{ user }}</div>
    <h1 class="fw-bold mb-2">Your Booking History</h1>
    <p>All your past and ongoing bookings in one place.</p>

    <!-- Stats -->
    <div class="stats-row">
      <div class="stat-chip">
        <span class="sc-num">{{ bookings|length }}</span>
        <span class="sc-lbl">Total Bookings</span>
      </div>
      <div class="stat-chip">
        <span class="sc-num" style="color:#86efac">
          {{ bookings|length }}
        </span>
        <span class="sc-lbl">This Account</span>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="container-xl pb-5">

  <!-- Filter Bar -->
  <div class="filter-card reveal">
    <i class="bi bi-funnel" style="color:var(--blue); font-size:1.05rem; flex-shrink:0"></i>
    <span class="filter-label">Filter by status:</span>
    <select class="filter-select" id="statusFilter">
      <option value="">All Bookings</option>
      <option value="pending">Pending</option>
      <option value="accepted">Accepted</option>
      <option value="rejected">Rejected</option>
      <option value="completed">Completed</option>
    </select>
    <span class="filter-label ms-auto" id="countLabel" style="color:var(--blue); font-weight:700"></span>
  </div>

  <!-- Bookings List -->
  <div class="d-flex flex-column gap-3 mt-4" id="bookingsList">

    {% for b in bookings %}

    <div class="booking-card {% if b.status == 'pending' %}bc-pending{% elif b.status == 'accepted' %}bc-accepted{% elif b.status == 'rejected' %}bc-rejected{% else %}bc-completed{% endif %} reveal booking-item"
         data-status="{{ b.status }}">

      <div class="d-flex align-items-start gap-3 flex-wrap">

        <!-- Worker Avatar -->
        <div class="worker-avatar av-c{{ forloop.counter0|divisibleby:6|yesno:'0,' }}{% cycle '0' '1' '2' '3' '4' '5' %}">
          {{ b.worker.user.username|slice:":2"|upper }}
        </div>

        <!-- Main Info -->
        <div class="flex-grow-1">
          <div class="d-flex align-items-center gap-2 flex-wrap mb-1">
            <p class="worker-name">{{ b.worker.user.username|title }}</p>

            <!-- Booking Status -->
            {% if b.status == 'pending' %}
              <span class="status-badge sb-pending">‚è≥ Pending</span>
            {% elif b.status == 'accepted' %}
              <span class="status-badge sb-accepted"><i class="bi bi-check-circle-fill"></i> Accepted</span>
            {% elif b.status == 'rejected' %}
              <span class="status-badge sb-rejected"><i class="bi bi-x-circle-fill"></i> Rejected</span>
            {% else %}
              <span class="status-badge sb-completed"><i class="bi bi-check-all"></i> Completed</span>
            {% endif %}

            <!-- Payment Status -->
            {% if b.work_status == 'completed' %}
              {% if b.payment_status == 'unpaid' %}
                <span class="pay-badge pay-unpaid"><i class="bi bi-exclamation-circle"></i> Unpaid</span>
              {% else %}
                <span class="pay-badge pay-paid"><i class="bi bi-check-circle-fill"></i> Paid</span>
              {% endif %}
            {% endif %}
          </div>

          <p class="worker-skill"><i class="bi bi-briefcase me-1" style="color:var(--blue)"></i>{{ b.worker.skill|title }}</p>

          <!-- Meta row -->
          <div class="meta-row">
            <span class="meta-item"><i class="bi bi-calendar3"></i>{{ b.requested_date }}</span>
            <span class="meta-item"><i class="bi bi-clock"></i>{{ b.requested_time }}</span>
            <span class="meta-item"><i class="bi bi-calendar-event"></i>Booked {{ b.created_at|date:"d M Y" }}</span>
            {% if b.work_status == 'completed' %}
            <span class="meta-item"><i class="bi bi-hourglass-split"></i>{{ b.total_hours }} hrs worked</span>
            {% endif %}
          </div>
        </div>

        <!-- Right side: fare + actions -->
        <div class="d-flex flex-column align-items-end gap-2 flex-shrink-0">

          <!-- Fare -->
          {% if b.fare %}
          <div class="{% if b.payment_status != 'unpaid' %}fare-tag paid{% else %}fare-tag{% endif %}">
            ‚Çπ{{ b.fare }}
          </div>
          {% endif %}

          <!-- Rating display -->
          {% if b.rating %}
          <div class="rating-display">
            {% for i in "12345" %}
              {% if forloop.counter <= b.rating %}
                <span class="star-filled">‚òÖ</span>
              {% else %}
                <span class="star-empty">‚òÖ</span>
              {% endif %}
            {% endfor %}
          </div>
          {% endif %}

          <!-- Action buttons -->
          <div class="d-flex gap-2 flex-wrap justify-content-end">
            {% if b.work_status == 'completed' and b.payment_status == 'unpaid' %}
              <a href="/payment/{{ b.id }}/" class="btn btn-pay-now">
                <i class="bi bi-credit-card"></i> Pay ‚Çπ{{ b.fare }}
              </a>
            {% endif %}

          </div>

        </div>
      </div>

    </div>


    {% empty %}
    <div class="empty-state reveal">
      <div class="empty-icon">üìã</div>
      <h4>No Bookings Yet</h4>
      <p>You haven't made any bookings yet.<br>Find a worker and book your first job!</p>
      <a href="/user_home/" class="btn btn-back px-4 mt-3">
        <i class="bi bi-search me-2"></i>Find Workers
      </a>
    </div>
    {% endfor %}

  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<footer>
  <div class="container-xl">
    <div class="footer-bottom d-flex justify-content-between flex-wrap gap-2">
      <span>¬© 2026 EmployIT ¬∑ All rights reserved.</span>
      <span>Made with ‚ù§Ô∏è for daily workers</span>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // ‚îÄ‚îÄ Scroll reveal ‚îÄ‚îÄ
  const observer = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
  }, { threshold: 0.08 });
  document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

  // ‚îÄ‚îÄ Status filter ‚îÄ‚îÄ
  const filter     = document.getElementById('statusFilter');
  const countLabel = document.getElementById('countLabel');
  const items      = document.querySelectorAll('.booking-item');

  function updateFilter() {
    const val = filter.value;
    let visible = 0;
    items.forEach(item => {
      const show = !val || item.dataset.status === val;
      item.style.display = show ? '' : 'none';
      if (show) visible++;
    });
    countLabel.textContent = visible + ' booking' + (visible !== 1 ? 's' : '');
  }

  // Init count
  countLabel.textContent = items.length + ' booking' + (items.length !== 1 ? 's' : '');
  filter.addEventListener('change', updateFilter);
</script>
</body>
</html>