{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ worker.user.username|title }}'s Bookings | EmployIT Admin</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --blue:      #3B4FD8;
      --blue-dark: #2a3ab5;
      --blue-light:#6B7FE8;
      --blue-pale: #EEF0FC;
      --accent:    #F5A623;
      --text:      #1a1d2e;
      --muted:     #6b7280;
      --bg:        #f7f8ff;
      --white:     #ffffff;
    }

    html { scroll-behavior: smooth; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); }
    h1,h2,h3,h4 { font-family: 'Playfair Display', serif; }
    em { color: var(--accent); font-style: normal; }

    /* ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ */
    .navbar {
      backdrop-filter: blur(14px);
      background: rgba(247,248,255,0.92) !important;
      border-bottom: 1px solid rgba(59,79,216,0.08);
      box-shadow: 0 4px 30px rgba(59,79,216,0.08);
    }
    .navbar-brand img { height: 40px; }
    .btn { border-radius: 50px !important; font-weight: 600; font-family: 'DM Sans', sans-serif; transition: all .25s; }
    .btn-back { background: var(--blue-pale); color: var(--blue); border: 2px solid var(--blue-pale); }
    .btn-back:hover { background: var(--blue); color: #fff; border-color: var(--blue); }
    .btn-employit { background: var(--blue); color: #fff; border: 2px solid var(--blue); }
    .btn-employit:hover { background: var(--blue-dark); color: #fff; }

    /* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
    .page-header {
      background: linear-gradient(135deg, var(--text) 0%, #2d3250 100%);
      padding: 5rem 0 5rem;
      margin-top: 72px;
      position: relative; overflow: hidden;
    }
    .page-header::before {
      content: ''; position: absolute; top: -60px; right: -60px;
      width: 380px; height: 380px;
      background: rgba(59,79,216,0.12); border-radius: 50%;
    }
    .page-header::after {
      content: ''; position: absolute; bottom: -80px; left: 5%;
      width: 260px; height: 260px;
      background: rgba(245,166,35,0.1); border-radius: 50%;
    }
    .page-header h1 { color: #fff; font-size: clamp(1.8rem, 4vw, 2.6rem); }
    .page-header p  { color: rgba(255,255,255,.65); margin: 0; font-size: .95rem; }
    .header-pill {
      display: inline-flex; align-items: center; gap: .5rem;
      background: rgba(255,255,255,.12); color: rgba(255,255,255,.9);
      padding: .35rem 1rem; border-radius: 50px;
      font-size: .8rem; font-weight: 600;
      margin-bottom: 1rem; backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,.15);
    }

    /* Worker strip in header */
    .worker-strip {
      display: flex; align-items: center; gap: 1rem;
      margin-top: 1.5rem; flex-wrap: wrap;
    }
    .worker-avatar-hdr {
      width: 58px; height: 58px; border-radius: 18px;
      background: rgba(255,255,255,.18); border: 2px solid rgba(255,255,255,.25);
      display: flex; align-items: center; justify-content: center;
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem; font-weight: 700; color: #fff;
      backdrop-filter: blur(6px); flex-shrink: 0;
    }
    .worker-strip h2 { color: #fff; font-size: 1.4rem; margin: 0; }
    .worker-strip p  { color: rgba(255,255,255,.65); margin: 0; font-size: .85rem; }

    /* Stats */
    .stats-row { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem; }
    .stat-chip {
      background: rgba(255,255,255,.1); border: 1px solid rgba(255,255,255,.18);
      border-radius: 14px; padding: .55rem 1.2rem;
      color: #fff; display: flex; align-items: center; gap: .6rem;
      backdrop-filter: blur(6px);
    }
    .stat-chip .sc-num { font-family: 'Playfair Display', serif; font-size: 1.3rem; font-weight: 700; }
    .stat-chip .sc-lbl { font-size: .72rem; color: rgba(255,255,255,.65); font-weight: 500; }

    /* ‚îÄ‚îÄ TABLE CARD ‚îÄ‚îÄ */
    .table-card {
      background: var(--white); border-radius: 24px;
      box-shadow: 0 8px 30px rgba(59,79,216,0.09);
      overflow: hidden;
      margin-top: -2rem; position: relative; z-index: 10;
    }
    .table-card-header {
      padding: 1.4rem 2rem;
      border-bottom: 1px solid var(--blue-pale);
      display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: .8rem;
    }
    .table-card-header h4 { font-size: 1.15rem; margin: 0; }
    .count-badge {
      background: var(--blue-pale); color: var(--blue);
      font-size: .8rem; font-weight: 700; border-radius: 50px; padding: .35rem 1rem;
    }

    /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
    .admin-table { width: 100%; border-collapse: collapse; }
    .admin-table thead tr { background: var(--bg); border-bottom: 2px solid var(--blue-pale); }
    .admin-table thead th {
      padding: 1rem 1.5rem;
      font-size: .73rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .8px;
      color: var(--muted); white-space: nowrap;
    }
    .admin-table tbody tr { border-bottom: 1px solid var(--blue-pale); transition: background .2s; }
    .admin-table tbody tr:hover { background: #fafbff; }
    .admin-table tbody tr:last-child { border-bottom: none; }
    .admin-table td { padding: 1rem 1.5rem; vertical-align: middle; }

    /* User cell */
    .user-cell { display: flex; align-items: center; gap: .75rem; }
    .mini-avatar {
      width: 36px; height: 36px; border-radius: 11px;
      background: linear-gradient(135deg, var(--blue), var(--blue-light));
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: .78rem; color: #fff; flex-shrink: 0;
    }
    .user-name { font-weight: 600; font-size: .88rem; margin: 0; }
    .user-sub  { font-size: .73rem; color: var(--muted); margin: 0; }

    /* Status badges */
    .badge-pill {
      display: inline-flex; align-items: center; gap: .3rem;
      font-size: .73rem; font-weight: 700; border-radius: 50px; padding: 4px 12px;
      white-space: nowrap;
    }
    .bp-pending     { background: #fffbeb; color: #92400e; border: 1.5px solid #fde68a; }
    .bp-accepted    { background: var(--blue-pale); color: var(--blue); border: 1.5px solid rgba(59,79,216,.2); }
    .bp-rejected    { background: #fef2f2; color: #dc2626; border: 1.5px solid #fca5a5; }
    .bp-completed   { background: #dcfce7; color: #16a34a; border: 1.5px solid #86efac; }
    .bp-not-started { background: #f1f5f9; color: var(--muted); border: 1.5px solid #e2e8f0; }
    .bp-in-progress { background: #fffbeb; color: #92400e; border: 1.5px solid #fde68a; }
    .bp-paid        { background: #dcfce7; color: #16a34a; border: 1.5px solid #86efac; }
    .bp-unpaid      { background: #fff7ed; color: #c2410c; border: 1.5px solid #fed7aa; }

    /* Fare */
    .fare-amt { font-family: 'Playfair Display', serif; font-weight: 700; font-size: 1rem; color: #16a34a; }
    .fare-na  { color: var(--muted); font-size: .82rem; }

    /* Stars */
    .star-on  { color: var(--accent); }
    .star-off { color: #d1d5db; }

    /* Empty */
    .empty-cell { text-align: center; padding: 4rem 2rem; }
    .empty-icon { font-size: 3rem; opacity: .2; margin-bottom: .8rem; }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer { background: var(--white); border-top: 1px solid rgba(59,79,216,.08); margin-top: 4rem; }
    .footer-bottom { font-size: .8rem; color: var(--muted); padding: 1.2rem 0; }

    /* ‚îÄ‚îÄ REVEAL ‚îÄ‚îÄ */
    .reveal { opacity: 0; transform: translateY(20px); transition: opacity .6s ease, transform .6s ease; }
    .reveal.visible { opacity: 1; transform: none; }
    .rv1 { transition-delay: .1s; }

    .table-scroll { overflow-x: auto; }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav class="navbar fixed-top py-3">
  <div class="container-xl d-flex justify-content-between align-items-center">
    <a href="/" class="navbar-brand">
      <img src="{% static 'img/logo.png' %}" alt="EmployIT">
    </a>
    <div class="d-flex gap-2">
      <a href="/admin_workers/" class="btn btn-back px-4">
        <i class="bi bi-arrow-left me-2"></i>Back
      </a>
      <a href="/admin_home/" class="btn btn-employit px-4">
        <i class="bi bi-grid me-1"></i>Dashboard
      </a>
    </div>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page-header">
  <div class="container-xl">
    <div class="header-pill"><i class="bi bi-shield-check me-1"></i> Admin Panel</div>
    <h1 class="fw-bold mb-2">Worker <em>Bookings</em></h1>

    <!-- Worker identity -->
    <div class="worker-strip">
      <div class="worker-avatar-hdr">
        {{ worker.user.username|slice:":2"|upper }}
      </div>
      <div>
        <h2>{{ worker.user.username|title }}</h2>
        <p>
          <i class="bi bi-briefcase me-1"></i>{{ worker.skill|title }}
          &nbsp;¬∑&nbsp;
          {% if worker.is_verified %}
            <i class="bi bi-patch-check-fill" style="color:#86efac"></i> Verified
          {% else %}
            <i class="bi bi-patch-exclamation-fill" style="color:#fde68a"></i> Unverified
          {% endif %}
        </p>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats-row">
      <div class="stat-chip">
        <span class="sc-num">{{ bookings|length }}</span>
        <span class="sc-lbl">Total Bookings</span>
      </div>
      <div class="stat-chip">
        <span class="sc-num" style="color:#86efac">{{ total_earned }}</span>
        <span class="sc-lbl">Total Earned (‚Çπ)</span>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="container-xl pb-5">

  <div class="table-card reveal">
    <div class="table-card-header">
      <h4>All <em>Bookings</em> ‚Äî sorted by date</h4>
      <span class="count-badge">
        <i class="bi bi-calendar-check me-1"></i>{{ bookings|length }} booking{{ bookings|length|pluralize }}
      </span>
    </div>

    <div class="table-scroll">
      <table class="admin-table">
        <thead>
          <tr>
            <th>#</th>
            <th><i class="bi bi-person me-1"></i>Customer</th>
            <th><i class="bi bi-calendar3 me-1"></i>Date</th>
            <th><i class="bi bi-clock me-1"></i>Time</th>
            <th><i class="bi bi-check2-circle me-1"></i>Status</th>
            <th><i class="bi bi-tools me-1"></i>Work</th>
            <th><i class="bi bi-cash-coin me-1"></i>Fare</th>
            <th><i class="bi bi-credit-card me-1"></i>Payment</th>
            <th><i class="bi bi-star me-1"></i>Rating</th>
          </tr>
        </thead>
        <tbody>

          {% for b in bookings %}
          <tr>

            <!-- Booking ID -->
            <td style="color:var(--muted); font-size:.82rem; font-weight:600">#{{ b.id }}</td>

            <!-- Customer -->
            <td>
              <div class="user-cell">
                <div class="mini-avatar">{{ b.user.username|slice:":2"|upper }}</div>
                <div>
                  <p class="user-name">{{ b.user.username|title }}</p>
                  <p class="user-sub">{{ b.created_at|date:"d M Y" }}</p>
                </div>
              </div>
            </td>

            <!-- Date -->
            <td style="font-weight:600; font-size:.88rem">{{ b.requested_date }}</td>

            <!-- Time -->
            <td style="font-size:.88rem; color:var(--muted)">{{ b.requested_time }}</td>

            <!-- Booking Status -->
            <td>
              {% if b.status == 'pending' %}
                <span class="badge-pill bp-pending">‚è≥ Pending</span>
              {% elif b.status == 'accepted' %}
                <span class="badge-pill bp-accepted"><i class="bi bi-check-circle-fill"></i> Accepted</span>
              {% elif b.status == 'rejected' %}
                <span class="badge-pill bp-rejected"><i class="bi bi-x-circle-fill"></i> Rejected</span>
              {% else %}
                <span class="badge-pill bp-completed"><i class="bi bi-check-all"></i> Completed</span>
              {% endif %}
            </td>

            <!-- Work Status -->
            <td>
              {% if b.work_status == 'not_started' %}
                <span class="badge-pill bp-not-started"><i class="bi bi-hourglass"></i> Not Started</span>
              {% elif b.work_status == 'in_progress' %}
                <span class="badge-pill bp-in-progress"><i class="bi bi-play-circle-fill"></i> In Progress</span>
              {% elif b.work_status == 'completed' %}
                <span class="badge-pill bp-completed"><i class="bi bi-check-circle-fill"></i> Done</span>
              {% endif %}
            </td>

            <!-- Fare -->
            <td>
              {% if b.fare %}
                <span class="fare-amt">‚Çπ{{ b.fare }}</span>
                {% if b.total_hours %}
                <br><small style="color:var(--muted); font-size:.73rem">{{ b.total_hours }} hrs</small>
                {% endif %}
              {% else %}
                <span class="fare-na">‚Äî</span>
              {% endif %}
            </td>

            <!-- Payment -->
            <td>
              {% if b.work_status == 'completed' %}
                {% if b.is_closed %}
                  <span class="badge-pill bp-paid"><i class="bi bi-check-circle-fill"></i> Paid</span>
                {% else %}
                  <span class="badge-pill bp-unpaid"><i class="bi bi-exclamation-circle"></i> Unpaid</span>
                {% endif %}
              {% else %}
                <span style="color:var(--muted); font-size:.82rem">‚Äî</span>
              {% endif %}
            </td>

            <!-- Rating -->
            <td>
              {% if b.rating %}
                <div>
                  {% for i in "12345" %}
                    {% if forloop.counter <= b.rating %}
                      <span class="star-on" style="font-size:.85rem">‚òÖ</span>
                    {% else %}
                      <span class="star-off" style="font-size:.85rem">‚òÖ</span>
                    {% endif %}
                  {% endfor %}
                </div>
              {% else %}
                <span style="color:var(--muted); font-size:.82rem">‚Äî</span>
              {% endif %}
            </td>

          </tr>
          {% empty %}
          <tr>
            <td colspan="9" class="empty-cell">
              <div class="empty-icon">üìã</div>
              <h5 style="font-family:'Playfair Display',serif; margin-bottom:.3rem">No Bookings Yet</h5>
              <p style="color:var(--muted); font-size:.88rem; margin:0">
                This worker has not received any bookings yet.
              </p>
            </td>
          </tr>
          {% endfor %}

        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<footer>
  <div class="container-xl">
    <div class="footer-bottom d-flex justify-content-between flex-wrap gap-2">
      <span>¬© 2026 EmployIT ¬∑ Admin Panel</span>
      <span>Made with ‚ù§Ô∏è for daily workers</span>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const observer = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
  }, { threshold: 0.08 });
  document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
</script>
</body>
</html>